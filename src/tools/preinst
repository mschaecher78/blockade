#!/bin/bash
# preinst script
# see: dh_installdeb(1)

set -e

function RebuildConfig () {

cat <<EOF > /usr/lib/blockade/blockade.conf.old
# This config file was auto generator, do not edit directly.

export hosts_name="${NAME}"
export raw_link="${LINK}"
export update_interval="${INTERVAL}"
export added_url="${added_url}"
EOF

}
case "${1}" in
	configure|upgrade)

		current=$(blockade --version | awk -F" " "{print $2}")
		required="20.12.10-0"

		if which blockade ; then

			if [ "${required}" = "${required}" ] ; then
				echo "backing up configuration"
				mv -f /usr/lib/blockade/blockade.conf /usr/lib/blockade/blockade.conf.old
			else

				if [ -f /usr/lib/blockade/blockade.conf ] ; then
					echo "sourcing old config file"
					source /usr/lib/blockade/blockade.conf
					export added_url=$(cat /usr/lib/blockade/user-added-links |
						awk -F' ' '{print $2}')
					RebuildConfig
				fi

			fi

		fi

	;;
	abort-upgrade|abort-remove|abort-deconfigure)
	;;
	triggered)
	;;
	*)
		echo "postinst called with unknown argument ${1}" >&2
		exit 1
	;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

exit 0
